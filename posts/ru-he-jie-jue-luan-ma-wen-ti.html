<!Doctype html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<meta name="renderer" content="webkit">
<meta name="HandheldFriendly" content="True">
<meta name="google-site-verification" content="xRiYQAQ0h0n3RXqrq0GgrdFm3BMFqDvDwwiRylv0YhQ">

<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<meta name="author" content="loggerhead" />    <meta name="keywords" content="工程问题,Python,Golang" />

  <meta name="description" content="相信几乎每一位中文开发者都遇到过中文乱码问题，其表象各式各样，不同编程语言的解决方法也不一而同。但是从本质上来说，表象的背后是相通的原理，不论什么编程语言，解决途径的背后是相同的方法。" />

  <title>  如何解决乱码问题？
</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">

  <link rel="stylesheet" href="../theme/css/style.5a21e2a.css">
 
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <link href="../atom.xml" rel="alternate" type="application/atom+xml">
</head>
<body>

<nav class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="..">loggerhead's blog</a>
    </div>
    <div class="navbar-collapse navbar-ex1-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
          <a href="../index.html">首页</a>
        </li>
        <li>
          <a href="../archives.html">归档</a>
        </li>
        <li>
          <a href="../about.html">关于</a>
        </li>
      </ul>
      <div class="navbar-right">
        <ul class="nav navbar-nav">
          <form class="navbar-form" role="search" action="https://www.google.com" target="_blank">
    <div class="input-group">
        <input type="text" class="search-query form-control" placeholder="搜索博客" name="q">
        <input type="hidden" name="cx" value="005992921674098475959:hyjwdbdoqt8">
        <input type="hidden" name="ie" value="UTF-8">
        <span class="input-group-btn">
            <button class="btn btn-default" type="submit">
                <span class="glyphicon glyphicon-search"></span>
            </button>
        </span>
    </div>
</form>
        </ul>
        <ul class="nav navbar-nav">
          <li><a href="https://github.com/loggerhead" target="_blank">GitHub</a></li>
          <li><a href="https://keybase.io/loggerhead" target="_blank">Keybase</a></li>
          <li><a href="https://douban.com/people/loggerhead" target="_blank">豆瓣</a></li>
        </ul>
      </div>
    </div><!--/.navbar-header -->
  </div><!--/.container -->
</nav><!--/.navbar -->

<div class="container">
  <div class="row">
    <div class="col-md-12">
      <div class="markdown-body article-list">
  <section id="content">
    <article>
      <header class="page-header">
        <h1>
          <a class="article-title" href="../posts/ru-he-jie-jue-luan-ma-wen-ti.html" rel="bookmark" title="Permalink to 如何解决乱码问题？">
            如何解决乱码问题？
          </a>
        </h1>
<footer class="post-info">
  <div class="row">
    <div class="col-xs-8">
      <!-- <span class="label label-default">Tags</span> -->
        <a class="tag btn btn-xs" href="../tag/gong-cheng-wen-ti.html">
          工程问题
        </a>
        <a class="tag btn btn-xs" href="../tag/python.html">
          Python
        </a>
        <a class="tag btn btn-xs" href="../tag/golang.html">
          Golang
        </a>
    </div>

    <div class="col-xs-4 time">
      <time class="pull-right" datetime="2018-11-24T10:00:00+08:00">
        2018-11-24
      </time>
    </div>
  </div>
</footer>        <hr>
      </header>
      <div class="entry-content">
        <p>相信几乎每一位中文开发者都遇到过中文乱码问题，其表象各式各样，不同编程语言的解决方法也不一而同。但是从本质上来说，表象的背后是相通的原理，不论什么编程语言，解决途径的背后是相同的方法。</p>


<div class="toc">
<ul>
<li><a href="#_1">乱码分析思路</a></li>
<li><a href="#_2">字节与字符</a></li>
<li><a href="#_3">常见编码</a><ul>
<li><a href="#unicode-utf-8">Unicode 与 UTF-8</a></li>
<li><a href="#gbkgb2312-gb18030">GBK、GB2312 与 GB18030</a></li>
</ul>
</li>
<li><a href="#_4">编码与解码</a></li>
<li><a href="#_5">乱码在哪里</a></li>
<li><a href="#_6">选择什么编码</a></li>
</ul>
</div>
<h2 id="_1">乱码分析思路</h2>
<p>乱码是由于底层的数据与其表现形式不一致造成的，因此要理清乱码，首先要清楚数据流的变化。数据流可以抽象成：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="err">输入 -&gt; 程序 -&gt; 输出</span>
</pre></div>
</td></tr></table>

<p>数据总是从 <code>输入</code> 流向 <code>程序</code>，<code>程序</code> 处理完成后流向 <code>输出</code>。抽象是为了帮助我们理解数据所处的环节，从而找出乱码产生的地方，最终解决乱码问题。下面用例子说明怎么解决乱码。</p>
<p>假设用户修改了昵称后发现昵称是乱码，对应的处理逻辑依次是：</p>
<ol>
<li>前端请求后台接口；</li>
<li>后台接口执行 MySQL 的 update 语句；</li>
<li>后台接口执行 MySQL 的 select 语句；</li>
<li>后台接口返回数据给前端；</li>
</ol>
<p>首先，疏理出上述过程对应的数据流：</p>
<table>
<thead>
<tr>
<th></th>
<th>输入</th>
<th>程序</th>
<th>输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>用户改昵称</td>
<td>后台接口</td>
<td>MySQL update</td>
</tr>
<tr>
<td>2</td>
<td>MySQL select</td>
<td>后台接口</td>
<td>前端页面</td>
</tr>
</tbody>
</table>
<p>其次，明确数据流每个环节的字符编码，假设每个环节的编码为：</p>
<table>
<thead>
<tr>
<th></th>
<th>输入</th>
<th>程序</th>
<th>输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>UTF-8</td>
<td>GBK</td>
<td>GBK</td>
</tr>
<tr>
<td>2</td>
<td>GBK</td>
<td>GBK</td>
<td>UTF-8</td>
</tr>
</tbody>
</table>
<p>最后，对字符编码不一致的环节进行编码转换：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">.</span> <span class="err">用户改昵称</span> <span class="c1">--------------&gt; 后台接口</span>
              <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="err">转</span> <span class="n">GBK</span>

<span class="mi">2</span><span class="p">.</span> <span class="err">后台接口</span> <span class="c1">----------------&gt; 前端页面</span>
              <span class="n">GBK</span> <span class="err">转</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
</pre></div>
</td></tr></table>

<p>我们把上面的例子归纳总结一下，得到解决乱码的关键：</p>
<ol>
<li><strong>疏理出数据流</strong>；</li>
<li><strong>弄清数据流的每一环节的编码</strong>；</li>
<li><strong>对编码不一致的环节进行编码转换</strong>；</li>
</ol>
<h2 id="_2">字节与字符</h2>
<p>要弄清每一环节的编码，需要先了解字节（byte）和字符（char）的区别，对于字符串（string）而言：</p>
<ul>
<li>字节是最小的<strong>存储</strong>单位；</li>
<li>字符是最小的<strong>显示</strong>单位；</li>
</ul>
<p>一个字节只能表示 256 个不同的字符，显然无法表示所有的文字，因此有了编码的概念。编码告诉计算机，哪些字节组成一个字符，或者怎么将一个字符存储成字节序列。同样的字符串，不同编码底层的字节序列可能是不同的。</p>
<p>以“你好”两个字为例，它的 GBK 和 UTF-8 的字节序列分别为：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="err">  GBK: 0xC4 0xE3 0xBA 0xC3</span>
<span class="c">UTF-8: 0xE4 0xBD 0xA0 0xE5 0xA5 0xBD</span>
</pre></div>
</td></tr></table>

<p>不同编程语言默认的字符编码是不同的，比如：</p>
<ul>
<li>C、Python 2 不区分字节与字符的概念，它们的字符串直接由字节组成；</li>
<li>Golang、Rust、Python 3 的字符串默认是 UTF-8 编码；</li>
<li>Java 的字符串是 UTF-16 编码；</li>
</ul>
<h2 id="_3">常见编码</h2>
<p>我们要弄清每一环节的编码，首先就得知道常见的编码有哪些。</p>
<h3 id="unicode-utf-8">Unicode 与 UTF-8</h3>
<p>计算机只存储二进制数字，因此是无法表示字符的。除非字符与数字之间能够一一映射，这样字符就能用数字表示了。最原始的 ASCII 码就定义了英文字母与数字间的映射关系，比如：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="err"> h   e   l   l   o</span>
<span class="err">104 101 108 108 111</span>
</pre></div>
</td></tr></table>

<p>ASCII 码的问题在于它无法表示包括中文、日文在内的非英文字符，因此有了 Unicode。Unicode（Universal Coded Character Set）是一组字符集，定义了每个字符与数字之间的映射关系，一个 Unicode 字符通常用 <code>U+</code> 和两个十六进制数来表示。比如：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="err">  你     好</span>
<span class="err">U+4F60 U+597D</span>
</pre></div>
</td></tr></table>

<p>看上去似乎用某个 Unicode 字符对应的数字就可以表示那个字符了，那为什么还存在 UTF-8 编码？原因有两点。</p>
<ol>
<li>
<p>Unicode 的字符集将来可能发生扩展（比如越来越多 emoji 表情），扩展意味着无法确定上限，也就无法确定最后一个字符对应的最大数字是多少。进而，没法确定用多少个字节来表示一个 Unicode 字符对应的数字；</p>
</li>
<li>
<p>目前 Unicode 包含了 13 万个字符，几乎涵盖了所有国家的所有字符。虽然上限不可知，但是可以退而求其次，用四个字节来表示一个 Unicode 字符，总共可以表示 4 亿多个字符，未来的扩展空间足够大了。这种直观的编码方式就是 UTF-32，但是它的缺点显而易见，如果每个英文字母都要四个字节来表示，岂不是很浪费存储空间？</p>
</li>
</ol>
<p>为了解决 Unicode 字符的存储问题，有了<strong>可变长度</strong>的字符编码 UTF-8（8-bit Unicode Transformation Format）。不同语言 UTF-8 占用的字节数可能不一样，比如：</p>
<ul>
<li>数字、英文字母占用 1 个字节，与 ASCII 码兼容；</li>
<li>大部分中文占用 3 个字节，少数占用 4 个字节；</li>
</ul>
<h3 id="gbkgb2312-gb18030">GBK、GB2312 与 GB18030</h3>
<p>GBK、GB2312 与 GB18030 是最常见的三种中文字符编码，其中“GB”意为“国家标准”。三者关系很简单：</p>
<ol>
<li>GB2312 包含了 6763 个字符，每个字符都用两个字节表示。但是它不支持繁体字等汉字，因此有了 GBK；</li>
<li>GBK 包含 21886 个字符，每个字符都用两个字节表示，兼容 GB2312，支持繁体中文、日文假名，但不支持韩国字；</li>
<li>GB18030 兼容 GBK 和 GB2312，是一种可变长度字符编码，不仅支持中日韩文字，还支持少数民族文字；</li>
</ol>
<p>整理一下，也就是：</p>
<table>
<thead>
<tr>
<th>编码名</th>
<th>占用字节数</th>
<th>支持字符集</th>
<th>兼容情况</th>
</tr>
</thead>
<tbody>
<tr>
<td>GB2312</td>
<td>2</td>
<td>不支持繁体字</td>
<td></td>
</tr>
<tr>
<td>GBK</td>
<td>2</td>
<td>支持繁体字</td>
<td>GB2312</td>
</tr>
<tr>
<td>GB18030</td>
<td>可变长</td>
<td>支持中日韩文字</td>
<td>GBK、GB2312</td>
</tr>
</tbody>
</table>
<h2 id="_4">编码与解码</h2>
<p>编码（encode）与解码（decode）是一组对立的概念，单独看某一个没有任何意义。因为「将 src 编码成 dst」，也可以说成是「将 src 解码成 dst」，比如下面两句话是一个意思：</p>
<ul>
<li>将字节序列编码为 GBK 字符串；</li>
<li>将字节序列解码为 GBK 字符串；</li>
</ul>
<p>因此如果进行编码转换，就必须<strong>清楚不同语境下 <code>encode</code> 和 <code>decode</code> 操作的 src、dst 分别指什么</strong>。不同语言的字符串组成不尽相同，那么 <code>encode</code> 的语义也可能不一样。</p>
<p>对 Python 2 而言：</p>
<ul>
<li><code>decode</code> 将 <code>str</code> 转成 <code>unicode</code>；</li>
<li><code>encode</code> 将 <code>unicode</code> 转成 <code>str</code>；</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># UTF-8 str =&gt; unicode</span>
<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;你好&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
<span class="c1"># unicode =&gt; GBK str</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;GBK&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>对 Python 3 而言：</p>
<ul>
<li><code>decode</code> 将 <code>bytes</code> 转成 <code>str</code>；</li>
<li><code>encode</code> 将 <code>str</code> 转成 <code>bytes</code>；</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># UTF-8 bytes =&gt; str</span>
<span class="n">s</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xE4\xBD\xA0\xE5\xA5\xBD</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="c1"># str =&gt; GBK bytes</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;gbk&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>对 Golang 的 <code>simplifiedchinese</code> 官方库而言：</p>
<ul>
<li><code>decode</code> 将 GBK <code>bytes</code> 转成 UTF-8 <code>bytes</code>；</li>
<li><code>encode</code> 将 UTF-8 <code>bytes</code> 转成 GBK <code>bytes</code>；</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;encoding/hex&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;golang.org/x/text/encoding/simplifiedchinese&quot;</span>
    <span class="s">&quot;golang.org/x/text/transform&quot;</span>
    <span class="s">&quot;io&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">GbkEncoder</span><span class="p">(</span><span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="nx">simplifiedchinese</span><span class="p">.</span><span class="nx">GBK</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">GbkDecoder</span><span class="p">(</span><span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">transform</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="nx">simplifiedchinese</span><span class="p">.</span><span class="nx">GBK</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="c1">// GBK bytes =&gt; UTF-8 bytes</span>
    <span class="nx">n</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">GbkDecoder</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="mh">0xC4</span><span class="p">,</span> <span class="mh">0xE3</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xC3</span><span class="p">}).</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">Dump</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">]))</span>
    <span class="c1">// UTF-8 bytes =&gt; GBK bytes</span>
    <span class="nx">n</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">GbkEncoder</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="mh">0xE4</span><span class="p">,</span> <span class="mh">0xBD</span><span class="p">,</span> <span class="mh">0xA0</span><span class="p">,</span> <span class="mh">0xE5</span><span class="p">,</span> <span class="mh">0xA5</span><span class="p">,</span> <span class="mh">0xBD</span><span class="p">}).</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">Dump</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">]))</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="_5">乱码在哪里</h2>
<p>任何能设置编码的地方，都可能导致乱码。这里列举出最常引入乱码的点，方便大家排查：</p>
<ul>
<li>前端页面编码；</li>
<li>代码文件编码（只影响字符串常量）；</li>
<li>文件编码；</li>
<li>数据库编码；</li>
<li>Linux 系统编码（<code>LANG</code>、<code>LC_ALL</code>等变量）；</li>
<li>终端（如：Putty、XShell、SecureCRT、iTerm2）编码；</li>
</ul>
<p>下面以 GBK 和 UTF-8 编码为例，列举出最常见的乱码情况：</p>
<ul>
<li>「文件/数据库/前端输入」是 GBK 编码，「编程语言」当作 UTF-8 字符串处理；</li>
<li>「代码文件」是 GBK 编码，导致字符串常量是 GBK 编码，而「编程语言」的默认编码是 UTF-8；</li>
<li>「程序」<code>print</code> 的字符串是 GBK 编码，而「终端」是 UTF-8 编码，导致显示出来是乱码；</li>
<li>「终端」是 GBK 编码，程序从终端读取用户输入，「编程语言」按 UTF-8 处理；</li>
</ul>
<p>如果不清楚某一环节的编码，可以将日志打到文件中，再用 <code>iconv</code> 工具进行编码转换，试探编码到底是哪一种。比如你猜测 <code>foo.txt</code> 文件是 GBK 编码，同时 <code>locale</code> 命令输出的编码和终端的编码都是 UTF-8，运行下面命令，如果正常显示出“你好”两个字，说明 <code>foo.txt</code> 的编码确实是我们猜测的 GBK 编码：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 打印出文件的字节序列</span>
$ hexdump foo.txt
<span class="m">0000000</span> c4 e3 ba c3
<span class="m">0000004</span>
<span class="c1"># 将 foo.txt 从 GBK 编码转换为 UTF-8 编码</span>
$ iconv -f gbk -t utf-8 foo.txt
你好
</pre></div>
</td></tr></table>

<p>如果弄清了每一环节的编码，就知道该在哪进行编码转换了。此时注意尽量在「逻辑边界」处进行编码转换，一方面避免重复进行编码转换带来的开销，另一方面降低心智负担。</p>
<h2 id="_6">选择什么编码</h2>
<p><strong>UTF-8</strong>。如果没有历史包袱，永远不要用 GBK，因为：</p>
<ul>
<li>万一将来遇到越南语或泰文，GBK 就没辙了；</li>
<li>现代编程语言的默认编码一般是 UTF-8，不可能是 GBK；</li>
<li>虽然 GBK 存储中文占用的字节数比 UTF-8 少，但是与开发效率相比，这点节省的存储成本不值一提；</li>
</ul>
      </div>
    </article>
  </section>
    <div id="disqus_thread"></div>
<script>
var disqus_config = function () {
    this.page.identifier = "如何解决乱码问题？";
};

(function() {
    var d = document, s = d.createElement('script');
    s.async = true;
    s.src = "//loggerhead.disqus.com/embed.js";
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
      </div>
    </div>
  </div>
</div>

 <footer class="page-footer">
  <div class="container">
    <div class="row">
      <div class="col-xs-8">
        <p>
          Copyright&nbsp;&copy;&nbsp;2018&nbsp;-&nbsp;loggerhead
        </p>
      </div>
      <div class="col-xs-4">
        <p class="pull-right">
          <a href="#" class="back-to-top">
            <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
            回到顶部
          </a>
        </p>
      </div>
    </div>

    <div class="row hidden-when-phone">
      <div class="col-xs-8">
        <p>
          Powered by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
          &middot;
          <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备16007488号</a>
        </p>

        <p>
          本站文章均为原创，并遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh_TW" target="_blank">CC BY-SA 4.0 协议</a>
        </p>
      </div><!--/.col-xs-8 -->

      <div class="col-xs-4">
        <p class="pull-right">
          <a href="https://portal.qiniu.com/signup?code=3lg1w78srwitul" target="_blank">
            <img style="height: 45px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFUAAAA5CAMAAABwHZdJAAAAnFBMVEUAAAAZivoZivoYiPoZifoZifoZifsaivgJkf8ZifoZifoYifoZifsZifoZifoYifsZifkbiv8ZifoZifoYiPsbh/8ZifoYifsZifsYivkZifkYifkZifkZiPoZifgUiP8ZifoZifoZifoZifoYifoYiPoZifsZifoZifsZifoZifoYifsYifsZivoaiPkYifkZifsYiPoZifoZifprs5E2AAAAM3RSTlMAZpc001w6GgSB/L2x9+BLKBL02j8J7eWriYZTUC8hDOjOuO+ln3hgRcnFfHNuWFZHao/W18NFAAACc0lEQVRYw63W6XqiMBgF4MgmCiIKKqBQcK/j1jn3f29jhthUJUhS3j8aeDzgl5WsHNI2wyPAn5ZDI0yJBgxbDe3R90wB+C2GdgB0CTGA1ai10AWA5e3zDCCYtBQ6xI1Fv+UADLu90IJQO9DYjxZC56DCsuHhJujyu7bjzBU7Cjiw1h7UVOepA6AnHZqA4gNqWbZ35OcFSy5z4pYhGrkb4emKBsCVCrW8MmJq82smSgarwhbA2JaaUEz4OHeZHu/Ma/MXLcDE5IEHJqC9r7N6NNLVcHd4vtXHnRMSQlt5o8xRb4y7fPLyL8C5V4N+6A3es7fCt35WuS5wA9wk7zL3mz4Y9hbCWC6oS7TDOMBP/VC0Njz5jOdZZS2tUzTDo7GwXvoKL2aHTfI1v4Z6mqZWOLyc4qgY40WQ1RT/E2rc+gX6L+Q12FCHHmQZVoPFR4OMxmum7qK5dfMNer9EM5EleVZ4b6qlRI6FN8buTn4DzdhvC1QxtMuIKLCnoAbd7ny7doJ8UDbzYLk5Du/zyNc0yVg2yzrsIaPM9/1s9LDrxEAhmbouU5fi2W2wsaowCAYT0R6Q48aUTDVBiQ+3BShdcWhpdaefgdzg4tujRypNQRlEloeSX7NtRNKpDkrHmpuJdKqGklNVHpRM6dQjIOyRHt+rJS3ALMiLGX+gpBTCsRUCikOATMYozUSzGS6RZ4BJRc9LFFJdMFtRxU2F1BiCsbXhxzV5X2D6L7OVXVfZD86oPJfbLpiZrZDq41vUuZj/nXeJB14ZFTPUOymlblGr/6GUaq9Qp0PU6KixJqoscWk1ou4j8SpL6u7J7+hm59miS+r9A2xo/FvmwrFSAAAAAElFTkSuQmCC" />
          </a>
        </p>
      </div>
    </div>
  </div>
</footer>
    <script src="../theme/js/bag.2.0.2.min.js"></script>

<script id="myscripts">
bag = new window.Bag();

bag.require([
    "https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js",
    "https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"
]);

function load_css(url, done) {
    var link  = document.createElement('link');
    link.rel  = 'stylesheet';
    link.href = url;
    link.onload = done;
    document.head.appendChild(link);
}

function load_js(url, done) {
    var script = document.createElement('script');
    script.src = url;
    script.onload = done;
    document.body.appendChild(script);
}

function gestureStart() {
    for (i = 0; i < metas.length; i++) {
        if (metas[i].name == "viewport") {
            metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
        }
    }
}

(function screen_suit() {
    var metas = document.getElementsByTagName('meta');
    var ua = navigator.userAgent;
    if (ua.match(/iPhone/i)) {
        for (var i = 0; i < metas.length; i++) {
            if (metas[i].name == "viewport") {
                metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
            }
        }
        document.addEventListener("gesturestart", gestureStart, false);
    }
})();

// See https://gist.github.com/vartan/ab195e5a502a47e0c3e5
(function fix_hover_behavior() {
    if('ontouchstart' in document.documentElement) {
        for(var sheetI = document.styleSheets.length - 1; sheetI >= 0; sheetI--) {
            var sheet = document.styleSheets[sheetI];
            if(sheet.cssRules) {
                for(var ruleI = sheet.cssRules.length - 1; ruleI >= 0; ruleI--) {
                    var rule = sheet.cssRules[ruleI];
                    if(rule.selectorText) {
                        rule.selectorText = rule.selectorText.replace(":hover", ":active");
                    }
                }
            }
        }
    }
})();

(function add_class_to_chinese_em(class_name) {
    var ems = document.getElementsByTagName("em");

    for (var i = 0; i < ems.length; i++) {
        var text = ems[i].textContent;
        // if has chinese char
        if(/.*[\u4e00-\u9fa5]+.*$/.test(text)) {
            ems[i].className += " " + class_name;
        }
    }
})('chinese');

// IE10 viewport hack for Surface/desktop Windows 8 bug
(function fix_ie10_viewport_bug() {
    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
        bag.require([
            "//maxcdn.bootstrapcdn.com/css/ie10-viewport-bug-workaround.css",
            "//maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"
        ]);
    }
})();

(function load_katex_when_need(class_name) {
    var maths = document.getElementsByClassName(class_name);
    if (maths.length == 0) {
        return;
    }

    bag.require([
        "https://cdn.jsdelivr.net/npm/katex@0.6.0/dist/katex.min.js"
    ]).then(function() {
        for (var i = 0; i < maths.length; i++) {
            var math = maths[i];

            var displayMode = null;
            if (math.tagName == "SPAN") {
                displayMode = false;
            } else if (math.tagName == "DIV") {
                displayMode = true;
            }

            if (displayMode === null) {
                console.log("Cannot render " + math);
            } else {
                try {
                    katex.render(math.textContent, maths[i], { displayMode: displayMode });
                } catch (err) {
                    console.log(err);
                }
            }
        }
    });

    load_css("https://cdn.jsdelivr.net/npm/katex@0.6.0/dist/katex.min.css");
})("math");
</script>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script>
  bag.require([
    "https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js",
    "https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"
  ]);
  </script>
<![endif]-->
 
</body>
</html>